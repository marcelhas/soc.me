---
title:  "Hardware: USB-HID Protocol Evolution (WIP)"
date:   2018-03-28 12:00:00 +0200
markdeep: true
---

### Motivation

### Existing Report Format for Keyboards

<div class="diagram">
 +---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+
 | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ |
 +---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+
  ╰──────┬──────╯ ╰──────┬──────╯ ╰──────┬──────╯ ╰──────┬──────╯ ╰──────┬──────╯ ╰──────┬──────╯ ╰──────┬──────╯ ╰──────┬───────┘
       Modifiers      Reserved       Scancode 1      Scancode 2      Scancode 3      Scancode 4      Scancode 5      Scancode 6
</div>

### Universal Report Format for Keyboards

<div class="diagram">
 +---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+┅
 | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ |
 +---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+┅
  ╰──────┬──────╯ ╰──────┬──────╯ ╰──────────────────────┬──────────────────────╯ ╰──────────────────────┬──────────────────────╯
  Modifiers left  Modifiers right                 Universal code 1                                Universal code 2
┅+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+┅
 | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ |
┅+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+┅
  ╰──────────────────────┬──────────────────────╯ ╰──────────────────────┬──────────────────────╯ ╰──────────────────────┬───────┈
                  Universal code 3                                Universal code 4                                Universal code 5
┅+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+┅
 | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ |
┅+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+┅
 ┈──────────────╯ ╰──────────────────────┬──────────────────────╯ ╰──────────────────────┬──────────────────────╯ ╰──────────────┈
                                  Universal code 6                                Universal code 7
┅+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+
 | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ | ┊ ┊ ┊ ┊ ┊ ┊ ┊ |
┅+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+
 ┈───────┬──────────────────────╯ ╰──────────────────────┬──────────────────────╯ ╰──────────────────────┬──────────────────────╯
  Universal code 8                                Universal code 9                                Universal code 10
</div>

#### Universal Code – Unicode codepoints

<div class="diagram">
 +---------------+---------------+---------------+
 |0┊ ┊ ┊u┊u┊u┊u┊u|u┊u┊u┊u┊u┊u┊u┊u|u┊u┊u┊u┊u┊u┊u┊u|
 +---------------+---------------+---------------+
  │    ╰────────────────────┬────────────────────╯
 Unicode selector    Unicode codepoint

 +------┅
 |0┊0┊0┊
 +------┅
   ╰─┬─╯
 Single codepoint

 +------┅
 |0┊1┊0┊
 +------┅
   ╰─┬─╯
 Multiple codepoints – start

 +------┅
 |0┊1┊1┊
 +------┅
   ╰─┬─╯
 Multiple codepoints – continue

 +------┅
 |0┊0┊1┊
 +------┅
   ╰─┬─╯
 Multiple codepoints – end
</div>



#### Universal Code – Legacy Usage Pages

<div class="diagram">
+---------------+---------------+---------------+
|1┊s┊s┊s┊s┊s┊s┊s|p┊p┊p┊p┊p┊p┊p┊p|p┊p┊p┊p┊p┊p┊p┊p|
+---------------+---------------+---------------+
 │ ╰─────┬─────╯ ╰──────────────┬──────────────╯
 │  Usage Page              Usage ID
Legacy Selector

+---------------+---------------+---------------+
|1┊0┊0┊0┊0┊1┊1┊1|0┊0┊0┊0┊0┊0┊0┊0|0┊0┊0┊0┊0┊1┊0┊0|
+---------------+---------------+---------------+
   ╰─────┬─────╯ ╰──────────────┬──────────────╯
Keyboard Page 0x07    Usage ID 0x04 (letter "A")

</div>
